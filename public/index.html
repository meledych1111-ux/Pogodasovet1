<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–¢–ï–¢–†–ò–° PRO ‚Ä¢ –ü–∏—Ç–æ–º—Ü—ã</title>
    <style>
        /* ==================== –°–ë–†–û–° –ò –û–°–ù–û–í–´ ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
            font-family: 'Segoe UI', 'Inter', system-ui, sans-serif;
            background: linear-gradient(145deg, #0a0a2a, #1a1a3a);
            color: white;
        }
        
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 6px;
        }
        
        .game-container {
            width: 100%;
            max-width: 500px;
            height: 98vh;
            max-height: 900px;
            background: linear-gradient(145deg, #0f1430, #1a1f40);
            border: 2px solid #4a5ccc;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.6);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }
        
        /* ==================== –≠–ö–†–ê–ù–´ ==================== */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 12px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.25s ease;
            background: inherit;
            overflow-y: auto;
        }
        
        .screen.active {
            opacity: 1;
            pointer-events: all;
        }
        
        /* ==================== –ú–ï–ù–Æ ==================== */
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 10px;
        }
        
        .game-title {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, #b3a0ff, #6b5bff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px #6b5bff80;
            letter-spacing: 2px;
        }
        
        .subtitle {
            color: #b5c8ff;
            font-size: 0.85rem;
            opacity: 0.9;
        }
        
        .menu-buttons {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 20px 0;
        }
        
        .menu-btn {
            background: rgba(30, 40, 90, 0.6);
            backdrop-filter: blur(4px);
            border: 2px solid rgba(100, 120, 255, 0.3);
            border-radius: 18px;
            padding: 18px;
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            transition: 0.15s;
            box-shadow: 0 6px 0 rgba(0,0,0,0.3);
        }
        
        .menu-btn:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 rgba(0,0,0,0.3);
        }
        
        .menu-btn.new-game { background: linear-gradient(145deg, #2a6e4b, #1e4f37); border-color: #6fcf97; }
        .menu-btn.stats { background: linear-gradient(145deg, #4a3f96, #32286a); border-color: #9d8cff; }
        .menu-btn.leaderboard { background: linear-gradient(145deg, #9b4b6e, #6d354c); border-color: #ff9eb5; }
        .menu-btn.settings { background: linear-gradient(145deg, #3a6e8c, #244b62); border-color: #8ed4ff; }
        
        .footer {
            text-align: center;
            padding: 16px;
            color: #aab5e0;
            border-top: 1px solid rgba(255,255,255,0.1);
            font-size: 0.8rem;
        }
        
        /* ==================== –ò–ì–†–û–í–û–ô –≠–ö–†–ê–ù ==================== */
        #game-screen {
            padding: 0px 6px 4px 6px; /* –í–ï–†–•–ù–ò–ô –û–¢–°–¢–£–ü 0! */
            display: flex;
            flex-direction: column;
        }
        
        /* –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ ‚Äî –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û –ö–û–ú–ü–ê–ö–¢–ù–û */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(12, 18, 50, 0.8);
            backdrop-filter: blur(4px);
            border: 1px solid #5a6acc;
            border-radius: 0 0 12px 12px; /* –¢–æ–ª—å–∫–æ –Ω–∏–∂–Ω–∏–µ —É–≥–ª—ã */
            padding: 4px 10px;
            margin-bottom: 2px;
            height: 44px;
            flex-shrink: 0;
        }
        
        .back-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 6px 14px;
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            min-width: 80px;
            justify-content: center;
        }
        
        .back-btn:before {
            content: "‚Üê";
            font-size: 1.1rem;
        }
        
        .game-info {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .info-box {
            background: rgba(0,0,0,0.4);
            border: 1px solid #3a4a9a;
            border-radius: 30px;
            padding: 4px 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 34px;
        }
        
        .info-label {
            display: none;
        }
        
        .info-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: #b3ffaa;
            text-shadow: 0 0 6px #00cc88;
        }
        
        /* –†–ê–ó–î–ï–õ–ò–¢–ï–õ–¨ –¢–û–ß–ö–ê */
        .game-info .info-box:not(:last-child) {
            position: relative;
            margin-right: 12px;
        }
        .game-info .info-box:not(:last-child)::after {
            content: "‚Ä¢";
            position: absolute;
            right: -12px;
            color: #8a9cff;
            font-size: 1.2rem;
            top: 50%;
            transform: translateY(-50%);
        }
        
        /* –ü–ê–ù–ï–õ–¨–ö–ê –ü–ò–¢–û–ú–¶–ê ‚Äî –≠–ú–û–î–ó–ò –ü–ò–¢–û–ú–¶–ê + –≠–ú–û–î–ó–ò –ï–î–´ + –ö–û–õ–ò–ß–ï–°–¢–í–û */
        .pet-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(255, 200, 210, 0.2);
            border: 2px solid #ffb6c1;
            border-radius: 40px;
            padding: 4px 16px;
            margin-left: 8px;
            height: 38px;
            font-size: 1.1rem;
            backdrop-filter: blur(4px);
            box-shadow: 0 0 12px rgba(255,200,220,0.3);
        }
        
        .pet-emoji {
            font-size: 1.4rem;
        }
        
        .pet-food-emoji {
            font-size: 1.2rem;
            filter: drop-shadow(0 0 6px gold);
        }
        
        .pet-food-count {
            font-size: 1.1rem;
            font-weight: 800;
            color: #ffd966;
            background: rgba(0,0,0,0.4);
            padding: 2px 10px;
            border-radius: 30px;
            margin-left: 2px;
        }
        
        /* –ò–ì–†–û–í–û–ï –ü–û–õ–ï ‚Äî –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–ê–Ø –í–´–°–û–¢–ê */
        .game-area {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 0;
            padding: 0;
            margin: 0;
        }
        
        #tetris-canvas {
            background: #0a0e24;
            border-radius: 16px;
            border: 3px solid #4a5ccc;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.8), 0 10px 20px rgba(0,0,0,0.5);
            width: 100%;
            height: auto;
            max-height: 100%;
            object-fit: contain;
        }
        
        /* –ù–ò–ñ–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ ‚Äî –ú–ò–ù–ò–ú–ê–õ–¨–ù–´–ô –û–¢–°–¢–£–ü */
        .game-controls-panel {
            margin-top: 2px;
            flex-shrink: 0;
        }
        
        .game-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
            padding: 6px;
            background: rgba(0,0,0,0.3);
            border-radius: 16px;
            margin-bottom: 4px;
        }
        
        .game-btn {
            background: #2a3670;
            border: none;
            border-bottom: 4px solid #121a40;
            color: white;
            padding: 12px 4px;
            border-radius: 14px;
            font-size: 0.85rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
            padding: 6px;
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
        }
        
        .control-btn {
            background: #2a3670;
            border-bottom: 5px solid #121a40;
            border-radius: 16px;
            padding: 14px 4px;
            font-size: 1.8rem;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* ==================== –õ–ò–î–ï–†–ë–û–†–î ==================== */
        .leaderboard-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px 4px;
        }
        
        .leaderboard-item {
            background: rgba(30, 40, 90, 0.6);
            border-left: 8px solid #ffb86b;
            border-radius: 20px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            backdrop-filter: blur(4px);
        }
        
        .rank {
            font-size: 1.8rem;
            font-weight: 800;
            min-width: 60px;
            text-align: center;
            color: #ffd966;
        }
        
        .player-info {
            flex: 1;
        }
        
        .player-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .player-score {
            color: #aaffaa;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        /* –ö–û–õ–õ–ï–ö–¶–ò–Ø –ü–ò–¢–û–ú–¶–ï–í –í –õ–ò–î–ï–†–ë–û–†–î–ï ‚Äî –í–°–ï –ü–ò–¢–û–ú–¶–´! */
        .pets-collection {
            background: rgba(0,0,0,0.35);
            border-radius: 40px;
            padding: 8px 14px;
            margin-top: 8px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 8px;
            border: 1px solid rgba(255,215,0,0.4);
        }
        
        .pets-collection span {
            font-size: 1.3rem;
            filter: drop-shadow(0 0 5px gold);
        }
        
        .pets-count-badge {
            background: #ffd966;
            color: #1a1e3a;
            font-weight: bold;
            padding: 4px 14px;
            border-radius: 30px;
            font-size: 0.9rem;
        }
        
        /* ==================== –ê–ù–ò–ú–ê–¶–ò–Ø –ï–î–´ ==================== */
        .food-particle {
            position: fixed;
            pointer-events: none;
            font-size: 2.4rem;
            animation: flyFood 1.2s ease-out forwards;
            z-index: 10000;
            text-shadow: 0 0 20px gold, 0 0 40px orange;
            filter: drop-shadow(0 0 10px yellow);
        }
        
        @keyframes flyFood {
            0% { opacity: 0; transform: scale(0.3) translateY(0) rotate(0deg); }
            20% { opacity: 1; transform: scale(1.4) translateY(-25px) rotate(20deg); }
            80% { opacity: 1; transform: scale(1.1) translateY(-90px) rotate(-15deg); }
            100% { opacity: 0; transform: scale(0.8) translateY(-140px) rotate(30deg); }
        }
        
        /* ==================== –ê–ù–ò–ú–ê–¶–ò–Ø –ü–û–õ–£–ß–ï–ù–ò–Ø –ü–ò–¢–û–ú–¶–ê ==================== */
        .pet-unlock {
            position: fixed;
            top: 100px;
            right: 20px;
            background: rgba(0,0,0,0.9);
            border-left: 8px solid;
            border-radius: 30px;
            padding: 16px 28px;
            display: flex;
            align-items: center;
            gap: 18px;
            font-size: 1.2rem;
            font-weight: bold;
            z-index: 10001;
            animation: slideIn 0.4s, fadeOut 0.4s 2.6s forwards;
            box-shadow: 0 10px 40px rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
        }
        
        @keyframes slideIn {
            from { transform: translateX(120%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes fadeOut {
            to { opacity: 0; transform: translateX(20px); }
        }
        
        /* ==================== –°–¢–ê–¢–ò–°–¢–ò–ö–ê ==================== */
        .stats-container {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }
        .stat-card {
            background: rgba(30,40,100,0.5);
            border-radius: 24px;
            padding: 20px;
            margin-bottom: 16px;
            border: 1px solid #6a7aff;
        }
        .pet-stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 40px;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        
        /* ==================== –ê–î–ê–ü–¢–ê–¶–ò–Ø ==================== */
        @media (max-height: 700px) {
            .game-header { height: 42px; padding: 2px 8px; }
            .pet-badge { height: 34px; padding: 2px 12px; }
            .control-btn { padding: 10px 2px; font-size: 1.6rem; }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ -->
        <div class="screen active" id="menu-screen">
            <div class="header">
                <h1 class="game-title">–¢–ï–¢–†–ò–° PRO</h1>
                <p class="subtitle">–∫–æ–ª–ª–µ–∫—Ü–∏—è –ø–∏—Ç–æ–º—Ü–µ–≤ ‚Ä¢ telegram</p>
            </div>
            <div class="menu-buttons">
                <button class="menu-btn new-game" onclick="startGame()">üéÆ –ù–û–í–ê–Ø –ò–ì–†–ê</button>
                <button class="menu-btn stats" onclick="showStats()">üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê</button>
                <button class="menu-btn leaderboard" onclick="showLeaderboard()">üèÜ –õ–ò–î–ï–†–ë–û–†–î</button>
                <button class="menu-btn settings" onclick="showSettings()">‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò</button>
            </div>
            <div class="footer">‚ö° Neon PostgreSQL ‚Ä¢ –ø–∏—Ç–æ–º—Ü—ã –≤ localStorage</div>
        </div>
        
        <!-- –ò–ì–†–û–í–û–ô –≠–ö–†–ê–ù -->
        <div class="screen" id="game-screen">
            <div class="game-header">
                <button class="back-btn" onclick="showMenu()"><span>–ú–ï–ù–Æ</span></button>
                <div class="game-info" id="game-info-container">
                    <div class="info-box"><span class="info-value" id="level-display">1</span></div>
                    <div class="info-box"><span class="info-value" id="score-display">0</span></div>
                    <div class="info-box"><span class="info-value" id="lines-display">0</span></div>
                    <!-- –ü–∞–Ω–µ–ª—å –ø–∏—Ç–æ–º—Ü–∞ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å -->
                </div>
            </div>
            
            <div class="game-area">
                <canvas id="tetris-canvas" width="240" height="480"></canvas>
            </div>
            
            <div class="game-controls-panel">
                <div class="game-buttons">
                    <button class="game-btn pause-btn" onclick="pauseGame()">‚è∏ –ü–ê–£–ó–ê</button>
                    <button class="game-btn" onclick="restartGame()">üîÑ –ó–ê–ù–û–í–û</button>
                    <button class="game-btn save-btn" onclick="saveGameScore()">üíæ –°–û–•–†–ê–ù–ò–¢–¨</button>
                </div>
                <div class="controls">
                    <button class="control-btn" onclick="moveLeft()">‚Üê</button>
                    <button class="control-btn" onclick="hardDrop()">‚¨áÔ∏è</button>
                    <button class="control-btn" onclick="rotatePiece()">‚Üª</button>
                    <button class="control-btn" onclick="moveRight()">‚Üí</button>
                </div>
            </div>
        </div>
        
        <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
        <div class="screen" id="stats-screen">
            <div class="header"><h1 class="game-title">üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê</h1></div>
            <div class="stats-container" id="user-stats"></div>
            <div class="footer"><button class="back-btn" onclick="showMenu()">‚Üê –ù–ê–ó–ê–î</button></div>
        </div>
        
        <!-- –õ–ò–î–ï–†–ë–û–†–î -->
        <div class="screen" id="leaderboard-screen">
            <div class="header"><h1 class="game-title">üèÜ –õ–ò–î–ï–†–ë–û–†–î</h1></div>
            <div class="leaderboard-list" id="leaderboard-list"></div>
            <div class="footer"><button class="back-btn" onclick="showMenu()">‚Üê –ù–ê–ó–ê–î</button></div>
        </div>
        
        <!-- –ù–ê–°–¢–†–û–ô–ö–ò -->
        <div class="screen" id="settings-screen">
            <div class="header"><h1 class="game-title">‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò</h1></div>
            <div class="stats-container">
                <div class="stat-card">
                    <h3>üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
                    <label>‚¨ÖÔ∏è‚û°Ô∏è –ö–ª–∞–≤–∏—à–∏ <input type="checkbox" id="keyboard-controls" checked></label>
                </div>
                <div class="stat-card">
                    <h3>üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</h3>
                    <div id="db-status">–°—Ç–∞—Ç—É—Å: <span id="db-status-text">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span></div>
                    <button onclick="testDatabase()">üîÑ –¢–µ—Å—Ç</button>
                </div>
            </div>
            <div class="footer"><button class="back-btn" onclick="showMenu()">‚Üê –ù–ê–ó–ê–î</button></div>
        </div>
    </div>
    
    <div id="notification" class="notification"></div>

    <script>
        // ==================== –¢–ï–õ–ï–ì–†–ê–ú ID ====================
        let telegramUserId = 'guest_' + Math.floor(Math.random() * 10000);
        let telegramUsername = 'Player';
        try {
            if (window.Telegram?.WebApp?.initDataUnsafe?.user?.id) {
                telegramUserId = String(window.Telegram.WebApp.initDataUnsafe.user.id);
                telegramUsername = window.Telegram.WebApp.initDataUnsafe.user.username || 'Player';
            }
        } catch(e) {}
        window.telegramUserId = telegramUserId;
        console.log('üë§ ID:', telegramUserId);

        // ==================== –ö–û–ù–°–¢–ê–ù–¢–´ ====================
        const COLS = 10, ROWS = 20, BLOCK_SIZE = 24;
        const COLORS = ['#FF6B6B','#4ECDC4','#45B7D1','#96CEB4','#FFEAA7','#DDA0DD','#98D8C8','#F7DC6F'];
        const SHAPES = [
            [[1,1,1,1]],
            [[1,1],[1,1]],
            [[0,1,0],[1,1,1]],
            [[1,1,0],[0,1,1]],
            [[0,1,1],[1,1,0]],
            [[1,0,0],[1,1,1]],
            [[0,0,1],[1,1,1]]
        ];
        
        // ==================== –£–†–û–í–ù–ò –ò –°–ö–û–†–û–°–¢–¨ ====================
        const SPEED_TABLE = {
            1: 800, 2: 750, 3: 700, 4: 650, 5: 600,
            6: 550, 7: 500, 8: 450, 9: 400, 10: 350,
            11: 300, 12: 280, 13: 260, 14: 240, 15: 220
        };
        
        // ==================== –í–°–ï –ü–ò–¢–û–ú–¶–´ (25) ====================
        const PETS = [
            { id: 'cat', name: '–ö–æ—Ç–µ–Ω–æ–∫', emoji: 'üê±', color: '#FFB6C1', score: 1000, food: 'üç£' },
            { id: 'dog', name: '–©–µ–Ω–æ–∫', emoji: 'üêï', color: '#D2B48C', score: 1500, food: 'ü¶¥' },
            { id: 'rabbit', name: '–ó–∞–π–∫–∞', emoji: 'üêá', color: '#F0F0F0', score: 2000, food: 'ü•ï' },
            { id: 'fox', name: '–õ–∏—Å–µ–Ω–æ–∫', emoji: 'ü¶ä', color: '#FF8C42', score: 2500, food: 'üçá' },
            { id: 'panda', name: '–ü–∞–Ω–¥–∞', emoji: 'üêº', color: '#2E2E2E', score: 3000, food: 'üéã' },
            { id: 'owl', name: '–°–æ–≤–µ–Ω–æ–∫', emoji: 'ü¶â', color: '#8B4513', score: 3500, food: 'üìö' },
            { id: 'penguin', name: '–ü–∏–Ω–≥–≤–∏–Ω', emoji: 'üêß', color: '#1E3F66', score: 4000, food: 'üêü' },
            { id: 'koala', name: '–ö–æ–∞–ª–∞', emoji: 'üê®', color: '#A9A9A9', score: 4500, food: 'üåø' },
            { id: 'tiger', name: '–¢–∏–≥—Ä–µ–Ω–æ–∫', emoji: 'üêØ', color: '#FFA500', score: 5000, food: 'ü•©' },
            { id: 'lion', name: '–õ—å–≤–µ–Ω–æ–∫', emoji: 'ü¶Å', color: '#FFD700', score: 5500, food: 'üëë' },
            { id: 'giraffe', name: '–ñ–∏—Ä–∞—Ñ–∏–∫', emoji: 'ü¶í', color: '#FFCC33', score: 6000, food: 'üåø' },
            { id: 'zebra', name: '–ó–µ–±—Ä–∞', emoji: 'ü¶ì', color: '#000000', score: 6500, food: 'üé®' },
            { id: 'elephant', name: '–°–ª–æ–Ω–µ–Ω–æ–∫', emoji: 'üêò', color: '#808080', score: 7000, food: 'üíß' },
            { id: 'rhino', name: '–ù–æ—Å–æ—Ä–æ–≥', emoji: 'ü¶è', color: '#696969', score: 7500, food: 'üõ°Ô∏è' },
            { id: 'hippo', name: '–ë–µ–≥–µ–º–æ—Ç', emoji: 'ü¶õ', color: '#8A6E4B', score: 8000, food: 'üí¶' },
            { id: 'monkey', name: '–û–±–µ–∑—å—è–Ω–∫–∞', emoji: 'üêí', color: '#8B4513', score: 8500, food: 'üçå' },
            { id: 'sloth', name: '–õ–µ–Ω–∏–≤–µ—Ü', emoji: 'ü¶•', color: '#6B8E23', score: 9000, food: '‚è∞' },
            { id: 'hedgehog', name: '–ï–∂–∏–∫', emoji: 'ü¶î', color: '#8B4513', score: 9500, food: 'üçé' },
            { id: 'squirrel', name: '–ë–µ–ª–æ—á–∫–∞', emoji: 'üêøÔ∏è', color: '#CD853F', score: 10000, food: 'üå∞' },
            { id: 'deer', name: '–û–ª–µ–Ω–µ–Ω–æ–∫', emoji: 'ü¶å', color: '#8B5A2B', score: 10500, food: 'üåø' },
            { id: 'unicorn', name: '–ï–¥–∏–Ω–æ—Ä–æ–≥', emoji: 'ü¶Ñ', color: '#FF69B4', score: 11000, food: '‚ú®' },
            { id: 'dragon', name: '–î—Ä–∞–∫–æ–Ω—á–∏–∫', emoji: 'üêâ', color: '#DC143C', score: 11500, food: 'üî•' },
            { id: 'phoenix', name: '–§–µ–Ω–∏–∫—Å', emoji: 'ü¶Ö', color: '#FF4500', score: 12000, food: 'üåÖ' },
            { id: 'whale', name: '–ö–∏—Ç', emoji: 'üêã', color: '#4169E1', score: 12500, food: 'üåä' },
            { id: 'dolphin', name: '–î–µ–ª—å—Ñ–∏–Ω', emoji: 'üê¨', color: '#4682B4', score: 13000, food: 'üèä' },
            { id: 'crocodile', name: '–ö—Ä–æ–∫–æ–¥–∏–ª', emoji: 'üêä', color: '#2E8B57', score: 13500, food: 'üêü' },
            { id: 'kangaroo', name: '–ö–µ–Ω–≥—É—Ä—É', emoji: 'ü¶ò', color: '#CD853F', score: 14000, food: 'ü¶ò' },
            { id: 'camel', name: '–í–µ—Ä–±–ª—é–¥', emoji: 'üê´', color: '#C19A6B', score: 14500, food: 'üåµ' },
            { id: 'peacock', name: '–ü–∞–≤–ª–∏–Ω', emoji: 'ü¶ö', color: '#4B0082', score: 15000, food: 'üåà' }
        ];

        // ==================== –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò–ì–†–´ ====================
        let board = [], currentPiece, currentX, currentY, score = 0, level = 1, lines = 0;
        let totalLines = 0, gameActive = false, gamePaused = false, gameOver = false;
        let dropCounter = 0, dropInterval = 800, lastTime = 0, animationId = null;
        let currentDifficulty = 'medium', clearedLinesAnimation = [], pieceQueue = [];
        
        // –ü–∏—Ç–æ–º—Ü—ã
        let userPets = [], activePet = null;
        
        // DOM
        const canvas = document.getElementById('tetris-canvas');
        const ctx = canvas.getContext('2d');
        const screens = {
            menu: document.getElementById('menu-screen'),
            game: document.getElementById('game-screen'),
            stats: document.getElementById('stats-screen'),
            leaderboard: document.getElementById('leaderboard-screen'),
            settings: document.getElementById('settings-screen')
        };

        // ==================== –ó–ê–ì–†–£–ó–ö–ê –°–û–•–†–ê–ù–ï–ù–ò–ô ====================
        function loadPets() {
            try {
                const saved = localStorage.getItem(`tetris_pets_${telegramUserId}`);
                if (saved) {
                    const data = JSON.parse(saved);
                    userPets = data.pets || [];
                    userPets.forEach(sp => {
                        const pet = PETS.find(p => p.id === sp.id);
                        if (pet) pet.rewards = sp.rewards || 0;
                    });
                    if (userPets.length) {
                        const last = userPets[userPets.length-1];
                        activePet = PETS.find(p => p.id === last.id);
                        if (activePet) activePet.rewards = last.rewards || 0;
                    }
                }
            } catch(e) { userPets = []; }
        }
        function savePets() {
            localStorage.setItem(`tetris_pets_${telegramUserId}`, JSON.stringify({
                pets: userPets.map(p => ({
                    id: p.id,
                    rewards: PETS.find(pet => pet.id === p.id)?.rewards || 0
                }))
            }));
        }

        // ==================== –ü–ê–ù–ï–õ–¨–ö–ê –ü–ò–¢–û–ú–¶–ê ====================
        function createPetPanel() {
            if (document.getElementById('pet-header-panel')) return;
            const container = document.getElementById('game-info-container');
            const panel = document.createElement('div');
            panel.id = 'pet-header-panel';
            panel.className = 'pet-badge';
            panel.style.display = 'none';
            panel.innerHTML = `
                <span id="pet-emoji-header" class="pet-emoji">üêæ</span>
                <span id="pet-food-emoji-header" class="pet-food-emoji">üç£</span>
                <span id="pet-food-count-header" class="pet-food-count">0</span>
            `;
            container.appendChild(panel);
        }
        
        function updatePetPanel() {
            const panel = document.getElementById('pet-header-panel');
            const emoji = document.getElementById('pet-emoji-header');
            const foodEmoji = document.getElementById('pet-food-emoji-header');
            const count = document.getElementById('pet-food-count-header');
            if (!panel || !emoji || !foodEmoji || !count) return;
            
            if (activePet && score >= 1000) {
                emoji.textContent = activePet.emoji;
                foodEmoji.textContent = activePet.food || 'üç£';
                count.textContent = activePet.rewards || 0;
                panel.style.display = 'flex';
                panel.style.borderColor = activePet.color + '80';
                panel.style.background = `rgba(${hexToRgb(activePet.color)}, 0.2)`;
            } else {
                panel.style.display = 'none';
            }
        }

        // ==================== –£–†–û–í–ï–ù–¨ –ü–û –û–ß–ö–ê–ú ====================
        function updateLevelByScore() {
            if (score < 1500) { level = 1; dropInterval = SPEED_TABLE[1]; return; }
            let newLevel = Math.min(15, Math.floor((score - 500) / 1000) + 1);
            if (newLevel !== level) {
                level = newLevel;
                dropInterval = SPEED_TABLE[level] || 220;
                showNotification(`üéâ –£–†–û–í–ï–ù–¨ ${level}!`);
                if (level === 7) showNotification('‚ú® –û—Ç–∫—Ä—ã—Ç –∑–æ–ª–æ—Ç–æ–π —Ç–µ—Ç—Ä–∏—Å!');
                if (level === 9) showNotification('üéÜ –û—Ç–∫—Ä—ã—Ç—ã —Ñ–µ–π–µ—Ä–≤–µ—Ä–∫–∏!');
                if (level === 11) showNotification('üåà –†–∞–¥—É–∂–Ω—ã–µ –±–ª–æ–∫–∏!');
                if (level === 13) showNotification('üëª –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å!');
                if (level === 15) showNotification('üíÄ –†–ï–ñ–ò–ú –ë–û–ì–ê!');
            }
        }

        // ==================== –ê–ù–ò–ú–ê–¶–ò–Ø –ï–î–´ ====================
        function showFoodAnimation(foodEmoji, count, color) {
            for (let i = 0; i < Math.min(count, 8); i++) {
                setTimeout(() => {
                    let el = document.createElement('div');
                    el.className = 'food-particle';
                    el.style.left = (window.innerWidth/2 - 80 + Math.random()*160) + 'px';
                    el.style.top = (window.innerHeight/2 - 80 + Math.random()*160) + 'px';
                    el.style.color = color || '#FFD700';
                    el.textContent = foodEmoji;
                    document.body.appendChild(el);
                    setTimeout(() => el.remove(), 1200);
                }, i * 70);
            }
        }

        // ==================== –ü–û–õ–£–ß–ï–ù–ò–ï –ü–ò–¢–û–ú–¶–ê ====================
        function unlockPet(pet) {
            if (userPets.some(p => p.id === pet.id)) return false;
            userPets.push({ id: pet.id, rewards: 0 });
            activePet = pet;
            activePet.rewards = 0;
            savePets();
            updatePetPanel();
            showFoodAnimation(pet.food, 5, pet.color);
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è
            let div = document.createElement('div');
            div.className = 'pet-unlock';
            div.style.borderLeftColor = pet.color;
            div.innerHTML = `<span style="font-size:2.5rem;">${pet.emoji}</span><span>‚ú® ${pet.name} –ø–æ–ª—É—á–µ–Ω!<br><span style="color:${pet.color};">+100 –æ—á–∫–æ–≤</span></span>`;
            document.body.appendChild(div);
            setTimeout(() => div.remove(), 3000);
            
            score += 100;
            updateDisplay();
            return true;
        }

        // ==================== –ö–û–†–ú–õ–ï–ù–ò–ï ====================
        function feedActivePet(linesCleared) {
            if (!activePet) {
                if (userPets.length) {
                    activePet = PETS.find(p => p.id === userPets[0].id);
                    if (activePet) activePet.rewards = userPets[0].rewards || 0;
                }
                return false;
            }
            let pet = PETS.find(p => p.id === activePet.id);
            if (!pet) return false;
            pet.rewards = (pet.rewards || 0) + linesCleared;
            activePet.rewards = pet.rewards;
            let userPet = userPets.find(p => p.id === pet.id);
            if (userPet) userPet.rewards = pet.rewards;
            savePets();
            showFoodAnimation(pet.food, linesCleared, pet.color);
            updatePetPanel();
            score += linesCleared * 10;
            updateDisplay();
            return true;
        }

        // ==================== –ü–†–û–í–ï–†–ö–ê –ü–ò–¢–û–ú–¶–ï–í ====================
        function checkPetUnlocks() {
            if (!score) return;
            PETS.forEach(pet => {
                if (!userPets.some(p => p.id === pet.id) && score >= pet.score) unlockPet(pet);
            });
        }

        // ==================== –õ–ò–î–ï–†–ë–û–†–î ‚Äî –í–°–ï –ü–ò–¢–û–ú–¶–´ ====================
        function getPetsCollection(score) {
            if (score < 1000) return { emojis: 'üêæ', count: 0, list: [] };
            let count = Math.min(28, Math.floor((score - 500) / 500));
            let allPets = PETS.map(p => p.emoji);
            let collection = [];
            for (let i = 0; i < count; i++) collection.push(allPets[i % allPets.length]);
            return { emojis: collection.join(' '), count, list: collection };
        }

        function loadLeaderboard() {
            let el = document.getElementById('leaderboard-list');
            el.innerHTML = '<div style="text-align:center;padding:40px;">üèÜ –ó–ê–ì–†–£–ó–ö–ê...</div>';
            fetch('/api/top-players?gameType=tetris&limit=10')
                .then(r => r.json())
                .then(data => {
                    let players = data.players || [];
                    el.innerHTML = '';
                    players.forEach((p, i) => {
                        let isMe = p.user_id === telegramUserId;
                        let col = getPetsCollection(p.best_score || 0);
                        let item = document.createElement('div');
                        item.className = 'leaderboard-item';
                        item.style.background = isMe ? 'linear-gradient(145deg, #2a5a4a, #1a3a3a)' : '';
                        item.innerHTML = `
                            <div class="rank">${i===0?'ü•á':i===1?'ü•à':i===2?'ü•â':i+1}</div>
                            <div class="player-info">
                                <div class="player-name" style="color:${isMe?'#aaffaa':'white'}">
                                    ${p.display_name || p.username || '–ò–≥—Ä–æ–∫'} ${isMe?'(–í—ã)':''}
                                </div>
                                <div class="player-score">${p.best_score || 0} –æ—á–∫–æ–≤</div>
                                <div class="pets-collection">
                                    <span style="color:#ffd900;">üêæ</span>
                                    <span style="font-size:1.2rem;">${col.emojis.slice(0,80)}</span>
                                    <span class="pets-count-badge">${col.count}</span>
                                </div>
                                ${p.city ? `<div style="color:#aad0ff;">üìç ${p.city}</div>` : ''}
                            </div>
                        `;
                        el.appendChild(item);
                    });
                })
                .catch(() => el.innerHTML = '<div style="padding:40px;color:red;">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>');
        }

        // ==================== –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–ò–¢–û–ú–¶–ï–í ====================
        function updatePetsStats() {
            let container = document.getElementById('user-stats');
            if (!container) return;
            let old = document.querySelector('.pets-stats-block');
            if (old) old.remove();
            if (userPets.length === 0) {
                container.innerHTML += '<div class="stat-card">üêæ –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–∏—Ç–æ–º—Ü–µ–≤. –ù–∞–±–µ—Ä–∏—Ç–µ 1000 –æ—á–∫–æ–≤!</div>';
                return;
            }
            let block = document.createElement('div');
            block.className = 'pets-stats-block stat-card';
            block.innerHTML = '<h3 style="color:#ffaacc;">üêæ –ú–û–Ø –ö–û–õ–õ–ï–ö–¶–ò–Ø</h3>';
            let sorted = PETS.filter(p => userPets.some(u => u.id === p.id)).sort((a,b) => (b.rewards||0) - (a.rewards||0));
            sorted.slice(0, 10).forEach(pet => {
                block.innerHTML += `<div class="pet-stat-row">
                    <span style="display:flex;gap:12px;"><span style="font-size:1.7rem;">${pet.emoji}</span> ${pet.name} ${activePet?.id===pet.id?'‚≠ê':''}</span>
                    <span style="color:${pet.color};font-size:1.4rem;">${pet.rewards||0} ${pet.food}</span>
                </div>`;
            });
            container.appendChild(block);
        }

        // ==================== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –ò–ì–†–´ ====================
        function showScreen(s) { Object.keys(screens).forEach(k => screens[k].classList.remove('active')); screens[s].classList.add('active'); }
        function showMenu() { showScreen('menu'); if (gameActive && !gamePaused) pauseGame(); }
        
        function startGame() {
            if (animationId) cancelAnimationFrame(animationId);
            board = Array(ROWS).fill().map(() => Array(COLS).fill(0));
            score = 0; level = 1; lines = 0; totalLines = 0; gameActive = true; gamePaused = false; gameOver = false;
            dropInterval = SPEED_TABLE[1];
            pieceQueue = []; clearedLinesAnimation = [];
            generatePieceQueue(); updateDisplay(); spawnPiece();
            if (!gameOver) {
                drawBoard(); showScreen('game');
                lastTime = 0; dropCounter = 0;
                animationId = requestAnimationFrame(gameLoop);
            }
        }
        
        function generatePieceQueue() {
            pieceQueue = [];
            for (let i=0;i<3;i++) pieceQueue.push(Math.floor(Math.random() * SHAPES.length));
        }
        
        function spawnPiece() {
            if (!pieceQueue.length) generatePieceQueue();
            let id = pieceQueue.shift();
            pieceQueue.push(Math.floor(Math.random() * SHAPES.length));
            currentPiece = { shape: SHAPES[id], color: COLORS[id] };
            currentX = Math.floor(COLS/2) - Math.floor(currentPiece.shape[0].length/2);
            currentY = 0;
            if (collide(currentPiece, currentX, currentY)) {
                gameOver = true;
                showNotification('üéØ –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –°—á–µ—Ç: ' + score);
                setTimeout(() => { showMenu(); loadUserStats(); }, 1500);
            }
        }
        
        function collide(piece, x, y) {
            for (let r=0; r<piece.shape.length; r++) {
                for (let c=0; c<piece.shape[r].length; c++) {
                    if (piece.shape[r][c]) {
                        let nx = x + c, ny = y + r;
                        if (nx<0 || nx>=COLS || ny>=ROWS) return true;
                        if (ny>=0 && board[ny] && board[ny][nx]) return true;
                    }
                }
            }
            return false;
        }
        
        function mergePiece() {
            for (let y=0; y<currentPiece.shape.length; y++)
                for (let x=0; x<currentPiece.shape[y].length; x++)
                    if (currentPiece.shape[y][x] && currentY+y>=0)
                        board[currentY+y][currentX+x] = currentPiece.color;
        }
        
        function moveDown() {
            if (gameOver||gamePaused) return;
            if (!collide(currentPiece, currentX, currentY+1)) currentY++;
            else { mergePiece(); checkLines(); spawnPiece(); }
            drawBoard();
        }
        
        function moveLeft() { if (!gameOver&&!gamePaused&&!collide(currentPiece,currentX-1,currentY)) { currentX--; drawBoard(); } }
        function moveRight() { if (!gameOver&&!gamePaused&&!collide(currentPiece,currentX+1,currentY)) { currentX++; drawBoard(); } }
        
        function rotatePiece() {
            if (gameOver||gamePaused) return;
            let rotated = currentPiece.shape[0].map((_,i) => currentPiece.shape.map(row => row[i]).reverse());
            let orig = currentPiece.shape;
            currentPiece.shape = rotated;
            if (collide(currentPiece, currentX, currentY)) currentPiece.shape = orig;
            drawBoard();
        }
        
        function hardDrop() {
            if (gameOver||gamePaused) return;
            let dist = 0;
            while (!collide(currentPiece, currentX, currentY+1)) { currentY++; dist++; }
            score += dist * 2;
            mergePiece(); checkLines(); spawnPiece(); updateDisplay(); drawBoard();
        }
        
        function checkLines() {
            let cleared = 0, rows = [];
            for (let y=ROWS-1; y>=0; y--) if (board[y].every(c => c!==0)) { rows.push(y); cleared++; }
            if (cleared > 0) {
                lines += cleared; totalLines += cleared; clearedLinesAnimation = rows;
                let bonus = [0,100,300,500,800];
                score += bonus[cleared] * level;
                feedActivePet(cleared);
                if (cleared === 4) {
                    showNotification('üéØ –¢–ï–¢–†–ò–°! +' + (800*level));
                    if (level >= 7) showNotification('‚ú® –ó–û–õ–û–¢–û–ô –¢–ï–¢–†–ò–°!');
                    if (level >= 9) for (let i=0;i<10;i++) setTimeout(()=>{let f=document.createElement('div');f.className='food-particle';f.style.left=Math.random()*window.innerWidth+'px';f.style.top=Math.random()*window.innerHeight*0.3+'px';f.style.fontSize='2.5rem';f.style.color='gold';f.innerHTML='üéÜ';document.body.appendChild(f);setTimeout(()=>f.remove(),1000);},i*50);
                }
                setTimeout(() => {
                    rows.sort((a,b)=>a-b).forEach(y => { board.splice(y,1); board.unshift(Array(COLS).fill(0)); });
                    clearedLinesAnimation = [];
                    updateDisplay(); drawBoard();
                }, 400);
                updateDisplay();
            }
        }
        
        function pauseGame() {
            if (gameActive && !gameOver) {
                gamePaused = !gamePaused;
                if (gamePaused) { cancelAnimationFrame(animationId); showNotification('‚è∏ –ü–∞—É–∑–∞'); }
                else { lastTime = 0; animationId = requestAnimationFrame(gameLoop); showNotification('‚ñ∂Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º'); }
            }
        }
        
        function restartGame() { if (confirm('–ù–æ–≤–∞—è –∏–≥—Ä–∞?')) { initGame(); showNotification('üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞'); } }
        
        function initGame() {
            board = Array(ROWS).fill().map(()=>Array(COLS).fill(0));
            score = 0; level = 1; lines = 0; gameActive = true; gamePaused = false; gameOver = false;
            dropInterval = SPEED_TABLE[1];
            clearedLinesAnimation = []; pieceQueue = [];
            generatePieceQueue(); updateDisplay(); spawnPiece(); drawBoard();
            if (animationId) cancelAnimationFrame(animationId);
            lastTime = 0; dropCounter = 0; animationId = requestAnimationFrame(gameLoop);
        }
        
        function updateDisplay() {
            document.getElementById('level-display').textContent = level;
            document.getElementById('score-display').textContent = score;
            document.getElementById('lines-display').textContent = lines;
            updateLevelByScore();
            checkPetUnlocks();
            updatePetPanel();
        }
        
        // ==================== –û–¢–†–ò–°–û–í–ö–ê ====================
        function drawBlock(x,y,col,isCurrent) {
            let s = BLOCK_SIZE, xx = x*s, yy = y*s;
            ctx.fillStyle = col; ctx.fillRect(xx,yy,s,s);
            let grad = ctx.createLinearGradient(xx,yy,xx+s,yy+s);
            grad.addColorStop(0, lightenColor(col,20));
            grad.addColorStop(0.7, col);
            ctx.fillStyle = grad; ctx.fillRect(xx,yy,s,s);
            if (isCurrent) { ctx.strokeStyle = 'white'; ctx.lineWidth = 3; ctx.strokeRect(xx+1,yy+1,s-2,s-2); }
        }
        
        function lightenColor(c,p) { let n=parseInt(c.slice(1),16), a=Math.round(2.55*p); return `rgb(${Math.min(255,(n>>16)+a)},${Math.min(255,((n>>8)&255)+a)},${Math.min(255,(n&255)+a)})`; }
        function darkenColor(c,p) { let n=parseInt(c.slice(1),16), a=Math.round(2.55*p); return `rgb(${Math.max(0,(n>>16)-a)},${Math.max(0,((n>>8)&255)-a)},${Math.max(0,(n&255)-a)})`; }
        function hexToRgb(h) { if (h.length===4) return `${parseInt(h[1]+h[1],16)},${parseInt(h[2]+h[2],16)},${parseInt(h[3]+h[3],16)}`; if (h.length===7) return `${parseInt(h[1]+h[2],16)},${parseInt(h[3]+h[4],16)},${parseInt(h[5]+h[6],16)}`; return '255,182,193'; }
        
        function drawBoard() {
            ctx.clearRect(0,0,canvas.width,canvas.height);
            ctx.fillStyle = '#0a0e24'; ctx.fillRect(0,0,canvas.width,canvas.height);
            for (let y=0; y<ROWS; y++) for (let x=0; x<COLS; x++) if (board[y][x]) drawBlock(x,y,board[y][x],false);
            if (clearedLinesAnimation.length) {
                ctx.globalAlpha = 0.7;
                clearedLinesAnimation.forEach(y => { ctx.fillStyle = '#ffffff'; ctx.fillRect(0,y*BLOCK_SIZE,COLS*BLOCK_SIZE,BLOCK_SIZE); });
                ctx.globalAlpha = 1;
            }
            if (currentPiece) for (let y=0; y<currentPiece.shape.length; y++) for (let x=0; x<currentPiece.shape[y].length; x++) if (currentPiece.shape[y][x]) drawBlock(currentX+x,currentY+y,currentPiece.color,true);
        }
        
        function gameLoop(time) {
            if (gameOver||gamePaused) return;
            let delta = time - lastTime; lastTime = time;
            dropCounter += delta;
            if (dropCounter > dropInterval) { moveDown(); dropCounter = 0; }
            drawBoard();
            animationId = requestAnimationFrame(gameLoop);
        }
        
        function showNotification(msg) {
            let n = document.getElementById('notification');
            if (!n) { n = document.createElement('div'); n.id = 'notification'; n.style.cssText = 'position:fixed;top:20px;right:20px;background:#2a6e4b;color:white;padding:12px 24px;border-radius:40px;z-index:20000;opacity:0;transition:0.2s;'; document.body.appendChild(n); }
            n.textContent = msg; n.style.opacity = '1';
            setTimeout(() => n.style.opacity = '0', 2000);
        }

        // ==================== –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ====================
        function loadUserStats() {
            let el = document.getElementById('user-stats');
            if (!el) return;
            fetch(`/api/user-stats?telegramId=${telegramUserId}&gameType=tetris`)
                .then(r => r.json())
                .then(d => {
                    if (d.success && d.stats) {
                        let s = d.stats;
                        el.innerHTML = `
                            <div class="stat-card"><h3>üìà –í–ê–®–ê –°–¢–ê–¢–ò–°–¢–ò–ö–ê</h3>
                                <div class="stat-row"><span>üèÜ –†–µ–∫–æ—Ä–¥</span><span>${s.best_score||0}</span></div>
                                <div class="stat-row"><span>üìä –£—Ä–æ–≤–µ–Ω—å</span><span>${s.best_level||1}</span></div>
                                <div class="stat-row"><span>üî∑ –í—Å–µ–≥–æ –ª–∏–Ω–∏–π</span><span>${s.best_lines||0}</span></div>
                                <div class="stat-row"><span>üéÆ –ò–≥—Ä —Å—ã–≥—Ä–∞–Ω–æ</span><span>${s.games_played||0}</span></div>
                            </div>
                        `;
                        updatePetsStats();
                    }
                });
        }

        // ==================== –ù–ê–°–¢–†–û–ô–ö–ò, –ë–î ====================
        function testDatabase() {
            let el = document.getElementById('db-status-text');
            if (el) { el.textContent = '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ'; el.style.color = '#aaffaa'; }
            showNotification('‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç');
        }
        
        function showStats() { loadUserStats(); showScreen('stats'); }
        function showLeaderboard() { loadLeaderboard(); showScreen('leaderboard'); }
        function showSettings() { showScreen('settings'); }
        function showLevels() { showNotification('‚ö° –í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–∂–Ω–æ—Å—Ç—å'); }
        function selectDifficulty(d) { currentDifficulty = d; }
        function renderLevels() {}
        async function saveGameScore() { showNotification('üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ'); }
        async function saveGameToDB() { return {success:true}; }

        // ==================== KEYBOARD ====================
        document.addEventListener('keydown', (e) => {
            if (!document.getElementById('keyboard-controls')?.checked) return;
            if (e.key === 'ArrowLeft') { e.preventDefault(); moveLeft(); }
            if (e.key === 'ArrowRight') { e.preventDefault(); moveRight(); }
            if (e.key === 'ArrowDown') { e.preventDefault(); moveDown(); }
            if (e.key === 'ArrowUp') { e.preventDefault(); rotatePiece(); }
            if (e.key === ' ') { e.preventDefault(); hardDrop(); }
            if (e.key === 'p' || e.key === 'P') { e.preventDefault(); pauseGame(); }
            if (e.key === 'Escape') { e.preventDefault(); showMenu(); }
        });

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        function init() {
            console.log('üöÄ –¢–µ—Ç—Ä–∏—Å PRO + –ü–∏—Ç–æ–º—Ü—ã');
            loadPets();
            createPetPanel();
            updatePetPanel();
            board = Array(ROWS).fill().map(() => Array(COLS).fill(0));
            drawBoard();
            adaptCanvasSize();
            window.addEventListener('resize', adaptCanvasSize);
            showNotification('üêæ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!');
        }
        
        function adaptCanvasSize() {
            let area = document.querySelector('.game-area');
            if (!area) return;
            let w = area.clientWidth - 12, h = area.clientHeight - 12;
            let scale = Math.min(w / (COLS*BLOCK_SIZE), h / (ROWS*BLOCK_SIZE), 1.3);
            canvas.style.width = Math.floor(COLS*BLOCK_SIZE*scale) + 'px';
            canvas.style.height = Math.floor(ROWS*BLOCK_SIZE*scale) + 'px';
        }

        window.addEventListener('load', init);
    </script>
</body>
</html>
